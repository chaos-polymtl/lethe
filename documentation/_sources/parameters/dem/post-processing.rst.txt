===============
Post-processing
===============

Lethe has built-in post-processing capabilities. All post-processing results are written as VTU, PTVU, PVD, CSV and/or DAT files. 

The post-processing subsection of the ``.prm`` file is according to the following example:

.. code-block:: text

  subsection post-processing
     # Enable output of grid, granular temperature, and particles' average velocity
     set lagrangian post-processing = false
     
     # Enable output of force chains
     set force chains = false
     
     # Enable particle-wall collision statistics
     subsection particle wall collision statistics
       set enable particle wall contact statistics = false
       set collision statistics file               = collision_statistics.csv
       set verbosity                               = quiet # Choices are quiet|verbose
       set log collisions with all walls           = true
       set wall boundary ids                       = 0
     end
  end

.. note::
 By default, post-processing options are set to ``false`` to reduce the number of files generated.

--------------------------
Lagrangian post-processing
--------------------------
The ``lagrangian post-processing`` enables VTU files output generated with the same ``output frequency`` as the particles' results (see the :doc:`../dem/simulation_control` section of this guide). The name of the generated files is set by the ``output name`` parameter in the simulation_control section plus the suffix ``-postprocess_data``. The files include:

* The grid of the domain, with the distribution of the subdomains generated by the load balance (more information about load balancing is provided in the :doc:`../dem/model_parameters` section of this guide).

* The spatial average of the particle's velocity (in x, y, z and its norm) for each cell.

* The granular temperature for each cell.

.. important::
 The particles' average velocity and the granular temperature are cell based results calculated instantaneously at each outputting time-step. This means that they are only instantaneous spatial averages, i.e, DO NOT correspond to temporal averages measured between the outputs. For a higher resolution of the results in time, we recommend the use of a lower ``output frequency`` (:doc:`../dem/simulation_control`).

----------------------------
Force chains post-processing
----------------------------
The ``force chains`` feature enables VTU, PTVU, and PVD files to visualize force chains between particles. The name of the generated files is set by the ``output name`` parameter in the simulation_control section plus the suffix ``-force_chains``. The files include:

* Lines to represent normal forces between particles in contact (use wireframe display with paraview).

* The force value for each line.

.. warning::
 The force chains feature is not implemented for contact occurring through periodic boundaries. 

The following video shows force chains for the `Rectangular Hopper example <../../examples/dem/rectangular-hopper/rectangular-hopper.html>`_.

 .. raw:: html

    <iframe width="560" height="315" src="https://www.youtube.com/embed/XrXXCz00Yjk?si=45mRK2E4yzT0BQIe" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

-----------------------------------
Particle-wall collision statistics
-----------------------------------

The particle-wall contact statistics logging feature allows to log the statistics of collisions between particles and walls in a .dat file or a .csv file. This feature is useful for post-processing and analysis of particle-wall interactions.

* ``enable particle wall collision statistics`` enables the feature.

* ``collision statistics file`` is the name of the file where the particle-wall contact statistics will be logged. The file will be created from the working directory of the simulation. If the name does not specify the format, the file will be created in .csv format. If the name ends with .dat or .csv, the file will be created in the corresponding format.

* ``verbosity`` controls the verbosity of the particle-wall collisions. The available options are ``quiet`` (the default option) and ``verbose``. If set to ``verbose``, the start and the end of a collision are printed in the terminal.

* ``log collisions with all walls`` is a boolean parameter that controls whether the particle-wall contact statistics will be logged for all walls or only for the walls defined by the ``wall boundary ids`` parameter. If set to ``true``, the statistics will be logged for all walls. If set to ``false``, the statistics will be logged only for the walls defined by the ``wall boundary ids`` parameter.

* ``wall boundary ids`` is the list of the wall boundary IDs where the particle-wall contact statistics will be logged when ``log collisions with all walls`` is set to false. When ``log collisions with all walls`` is set to true, this parameter is ignored. Each wall boundary ID must be separated by a comma.
