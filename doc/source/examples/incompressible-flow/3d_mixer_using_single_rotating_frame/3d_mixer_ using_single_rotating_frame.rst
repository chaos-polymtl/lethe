.. role:: raw-html(raw)
    :format: html

========================================================
3D Ribbon Mixer using a Single Rotating Reference Frame
========================================================

In the industry, when designing a mixer, we need to evaluate the power consumed by the agitator. To do so, we refer to the power number (:math:`N_p`) vs Reynolds number (:math:`Re`) curves. The :math:`N_p` relates the power consumed by the agitator to the geometry of the system and the characteristics of the flow in the tank. In this example, using a single rotating reference frame, we model a ribbon mixer for different flow conditions (different values of :math:`Re`) to generate :math:`N_p` vs :math:`Re` curves.

:raw-html:`<br />`

Features
-------------
- Solver: ``gls_navier_stokes_3d`` (with Q1-Q1)
- Steady-state problem
- Displays the use of a single rotating frame (srf) when modeling a complex rotating geometry
- Calculation of the power number (:math:`N_p`) with a python script
- Use of a cluster to run simulations

:raw-html:`<br />`

Locations of Files Used in the Example
---------------------------------------
- Parameter file: ``examples/incompressible_flow/3d_ribbon_mixer_srf/ribbon_gls.prm``


:raw-html:`<br />`

Description of the Case
-------------------------
We simulate the flow generated by a double helical ribbon impeller in a cylindrical mixing tank. The double helical ribbon impeller is an axial and a tangential impeller making it a great option for mixing viscous fluids.

The following figure represents the geometry of our system:

<insert image>

<insert description of the image>

The Reynolds number for our system is defined as follows:

.. math::
    Re = \frac{NDÂ²}{\nu}

where

- N is the angular velocity :math:`[rps]`;
- D is the diameter of the impeller :math:`[m]`, and
- \nu is the kinematic viscosity of the fluid :math:`[N \cdot s/m^2]`.

To be able to simulate the flow in such complex geometry, we take advantage of the symmetry of the system and opt for a Lagrangian reference frame. Instead of observing the velocity profile from an Eulerian reference frame (or lab reference frame), we place ourselves on the impeller's reference making it static and inducing a no-slip boundary condition on it. This way, the cylindrical vessel is going to be the only moving geometry in our system. The figure below illustrates the difference between the Eulerian and Lagrangian reference frames.

.. image:: images/eulerian_vs_langrangian_reference.jpg
   :alt: Eulerian and Lagrangian reference frames
   :align: center
   :name: Eulerian and Lagrangian reference frames
   :height: 5cm

In this example, we will start by simulating the case when :math:`Re = 1` and then follow with simulation a for :math:`Re` values ranging for :math:`0.1` to :math:`100`.


:raw-html:`<br />`

Parameter File
--------------
Except for the ``velocity source`` subsection, all other subsections in ``ribbon_gls.prm`` were discussed in previous examples.

Simulation Control
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: text

  subsection simulation control
    set method                  = steady
    set output name             = mixer
    set output frequency        = 1
    set output boundaries       = true
    set output path             = ./output/
  end


FEM
~~~~~

.. code-block:: text

    subsection FEM
        set velocity order            = 1
        set pressure order            = 1
    end


Physical Properties
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: text

    subsection physical properties
      subsection fluid 0
        set kinematic viscosity            = 0.11602395351399172
       end
    end

Velocity Source
~~~~~~~~~~~~~~~~~

.. code-block:: text

    subsection velocity source
        set type         = srf
        set omega_z      = -10
    end

In the ``velocity source`` subsection, we specify that we are in a single rotating frame (``srf``). Since a centrifugal and a Coriolis force are induced by the rotating nature of the system, we are in a non-Galilean reference frame. These two additional force contributions must be taken into account in the Navier-Stokes equations and by setting the ``type`` parameter to ``srf`` we do so. The ``omega_z`` parameter represents the angular velocity of the reference frame.


Force
~~~~~~~

.. code-block:: text

    subsection forces
        set verbosity             = verbose   # Output force and torques in log <quiet|verbose>
        set calculate torque      = true      # Enable torque calculation
        set torque name           = torque    # Name prefix of torque files
        set output precision      = 14        # Output precision
        set calculation frequency = 1         # Frequency of the force calculation
        set output frequency      = 1         # Frequency of file update
    end


Mesh Adaptation Control
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: text

    subsection mesh adaptation
      set type                    = kelly
      set variable                = velocity
      set fraction type           = number
      set max number elements     = 600000
      set max refinement level    = 2
      set min refinement level    = 0
      set frequency               = 1
      set fraction refinement     = 0.15
      set fraction coarsening     = 0.00
    end


Mesh
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: text

    subsection mesh
        set type                 = gmsh
        set file name            = diff_step_mesh.msh
        set initial refinement   = 0
        set simplex = true
    end


Boundary Conditions
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: text

    subsection boundary conditions
      set number                         = 3
        subsection bc 0
            set id = 1
            set type                     = function
            subsection u
                set Function expression  = -10*y     #2*0.314159*y
            end
            subsection v
                set Function expression  = 10*x      #2*0.314159*x
            end
            subsection w
                set Function expression  = 0
            end
        end
        subsection bc 1
            set id = 2
            set type                     = slip
        end

        subsection bc 2
            set id  = 3
            set type                     = noslip
        end
    end


Non-Linear Solver Control
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: text

    subsection non-linear solver
      set tolerance               = 1e-10
      set verbosity               = verbose
    end


Linear Solver Control
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: text

    subsection linear solver
      set method                                       = amg
      set max iters                                    = 100
      set relative residual                            = 1e-4
      set minimum residual                             = 1e-10
      set amg preconditioner ilu fill                  = 0
      set amg preconditioner ilu absolute tolerance    = 1e-11
      set amg preconditioner ilu relative tolerance    = 1.00
      set amg aggregation threshold                    = 1e-14  # Aggregation
      set amg n cycles                                 = 2      # Number of AMG cycles
      set amg w cycles                                 = false  # W cycles, otherwise V cycles
      set amg smoother sweeps                          = 2      # Sweeps
      set amg smoother overlap                         = 1      # Overlap
      set verbosity                                    = verbose
      set max krylov vectors                           = 500
    end


:raw-html:`<br />`

Running the Simulation
------------------------------------

Simulating for a Specific Flow Condition (:math:`Re = 1`)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Launching the simulation is as simple as specifying the executable name and the parameter file. Assuming that the gls_navier_stokes_3d executable is within your path, the simulation can be launched by typing:

.. code-block:: text

    gls_navier_stokes_3d ribbon_gls.prm

Simulating for
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


:raw-html:`<br />`

Results
--------


:raw-html:`<br />`

References
-----------

