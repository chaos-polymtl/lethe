# SPDX-FileCopyrightText: Copyright (c) 2025 The Lethe Authors
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception OR LGPL-2.1-or-later

# Listing of Parameters
#----------------------

# Test the sedimentation of a single particle with the explicit coupling.
# The particle should follow the analytical solution but slightly overshoot
# it due to the two-way coupling.
# This test is identical to
# /lethe-fluid-particles-matrix-free/explicit-particle-sedimentation.prm
# but uses load balancing in parallel

set dimension = 3

#---------------------------------------------------
# Simulation Control
#---------------------------------------------------

subsection simulation control
  set method           = bdf1
  set output name      = result
  set output frequency = 0
  set time end         = 0.25
  set time step        = 0.005
end

#---------------------------------------------------
# FEM
#---------------------------------------------------

subsection FEM
  set velocity order = 1
  set pressure order = 1
end

#---------------------------------------------------
# Physical Properties
#---------------------------------------------------

subsection physical properties
  subsection fluid 0
    set kinematic viscosity = 1e-6
    set density             = 1000
  end
end

#---------------------------------------------------
# Mesh
#---------------------------------------------------

subsection mesh
  set type           = dealii
  set grid type      = subdivided_hyper_rectangle
  set grid arguments = 4,8,4:-0.025,0,-0.025:0.025,0.10,0.025:false
end

#---------------------------------------------------
# Void Fraction
#---------------------------------------------------

subsection void fraction
  set mode                         = qcm
  set qcm sphere equal cell volume = false
  set qcm sphere diameter          = 0.0075
  set read dem                     = false
  set dem file name                = dem
  set l2 smoothing length          = 0.0125
  set quadrature rule              = gauss-lobatto
  set n quadrature points          = 5
end

#---------------------------------------------------
# CFD-DEM
#---------------------------------------------------

subsection cfd-dem
  set grad div                      = true
  set void fraction time derivative = false
  set drag force                    = true
  set buoyancy force                = true
  set shear force                   = false
  set pressure force                = false
  set drag model                    = dallavalle
  set coupling frequency            = 1
  set grad-div length scale         = 0.005
  set vans model                    = modelA
  set drag coupling                 = explicit
end

#---------------------------------------------------
# Boundary Conditions
#---------------------------------------------------

subsection boundary conditions
  set number = 1
  subsection bc 0
    set id   = 0
    set type = slip
  end
end

#---------------------------------------------------
# Model parameters
#---------------------------------------------------

subsection model parameters
  subsection contact detection
    set contact detection method = dynamic
    set neighborhood threshold   = 1.3
  end
  subsection load balancing
    set load balance method = frequent
    set frequency           = 10
  end
end

#---------------------------------------------------
# Physical Properties
#---------------------------------------------------

subsection lagrangian physical properties
  set g                        = 0.0, -9.81, 0.0
  set number of particle types = 1
  subsection particle type 0
    set size distribution type = uniform
    set diameter               = 0.0025
    set number of particles    = 1
    set density particles      = 1100
  end
end

#---------------------------------------------------
# Insertion Info
#---------------------------------------------------

subsection insertion info
  set insertion frequency = 1
  set insertion method    = list
  set list x              = 0
  set list y              = 0.08
  set list z              = 0
end

#---------------------------------------------------
# Non-Linear Solver Control
#---------------------------------------------------

subsection non-linear solver
  subsection fluid dynamics
    set tolerance = 1e-11
    set verbosity = quiet
  end
end

#---------------------------------------------------
# Linear Solver Control
#---------------------------------------------------

subsection linear solver
  subsection void fraction
    set relative residual = 1e-13
    set minimum residual  = 1e-13
    set verbosity         = quiet
  end
  subsection fluid dynamics
    set method                                = gmres
    set max iters                             = 500
    set max krylov vectors                    = 500
    set relative residual                     = 1e-3
    set minimum residual                      = 1e-12
    set preconditioner                        = ilu
    set ilu preconditioner absolute tolerance = 1e-13
    set verbosity                             = quiet
  end
end
