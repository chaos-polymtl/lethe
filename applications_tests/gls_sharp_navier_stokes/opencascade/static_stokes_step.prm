# Listing of Parameters
# ---------------------

set dimension = 3

# --------------------------------------------------
# Simulation and IO Control
#---------------------------------------------------

subsection simulation control
  set method            = steady
  set time step         = 0.0025 # Time step
  set number mesh adapt = 0      # If steady, nb mesh adaptation
  set time end          = 3      # End time of simulation
  set output name       = out    # Prefix for VTU outputs
  set output frequency  = 0      # Frequency of simulation output
end

#---------------------------------------------------
# Physical Properties
#---------------------------------------------------

subsection physical properties
  subsection fluid 0
    set kinematic viscosity = 1
    set density             = 1
  end
end

#---------------------------------------------------
# Timer
#---------------------------------------------------

subsection timer
  set type = none
end

#---------------------------------------------------
# FEM
#---------------------------------------------------

subsection FEM
  set velocity order = 1
  set pressure order = 1
end

#---------------------------------------------------
# Mesh
#---------------------------------------------------

subsection mesh
  set type               = dealii
  set grid type          = subdivided_hyper_rectangle
  set grid arguments     = 5,5,5: -2,-2,-2 : 2 , 2 ,2 : true
  set initial refinement = 0
end

subsection box refinement
  set initial refinement = 3
  subsection mesh
    set type               = dealii
    set grid type          = subdivided_hyper_rectangle
    set grid arguments     = 1,1,1: -0.75,-0.75,-0.75 : 0.75, 0.75 ,0.75 : true
    set initial refinement = 0
  end
end

# --------------------------------------------------
# Boundary Conditions
#---------------------------------------------------

subsection boundary conditions
  set number = 6
  subsection bc 0
    set id   = 0
    set type = function
    subsection u
      set Function expression = (x^2*(-0.75*(x^2 + y^2 + z^2)^(3/2) + 0.0625*sqrt(x^2 + y^2 + z^2) + (x^2 + y^2 + z^2)^2) - (y^2 + z^2)*(0.375*(x^2 + y^2 + z^2)^(3/2) + 0.03125*sqrt(x^2 + y^2 + z^2) - (x^2 + y^2 + z^2)^2))/(x^2 + y^2 + z^2)^3
    end
    subsection v
      set Function expression = x*y*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
    subsection w
      set Function expression = x*z*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
  end
  subsection bc 1
    set id   = 1
    set type = function
    subsection u
      set Function expression = (x^2*(-0.75*(x^2 + y^2 + z^2)^(3/2) + 0.0625*sqrt(x^2 + y^2 + z^2) + (x^2 + y^2 + z^2)^2) - (y^2 + z^2)*(0.375*(x^2 + y^2 + z^2)^(3/2) + 0.03125*sqrt(x^2 + y^2 + z^2) - (x^2 + y^2 + z^2)^2))/(x^2 + y^2 + z^2)^3
    end
    subsection v
      set Function expression = x*y*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
    subsection w
      set Function expression = x*z*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
  end

  subsection bc 2
    set id   = 2
    set type = function
    subsection u
      set Function expression = (x^2*(-0.75*(x^2 + y^2 + z^2)^(3/2) + 0.0625*sqrt(x^2 + y^2 + z^2) + (x^2 + y^2 + z^2)^2) - (y^2 + z^2)*(0.375*(x^2 + y^2 + z^2)^(3/2) + 0.03125*sqrt(x^2 + y^2 + z^2) - (x^2 + y^2 + z^2)^2))/(x^2 + y^2 + z^2)^3
    end
    subsection v
      set Function expression = x*y*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
    subsection w
      set Function expression = x*z*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
  end
  subsection bc 3
    set id   = 3
    set type = function
    subsection u
      set Function expression = (x^2*(-0.75*(x^2 + y^2 + z^2)^(3/2) + 0.0625*sqrt(x^2 + y^2 + z^2) + (x^2 + y^2 + z^2)^2) - (y^2 + z^2)*(0.375*(x^2 + y^2 + z^2)^(3/2) + 0.03125*sqrt(x^2 + y^2 + z^2) - (x^2 + y^2 + z^2)^2))/(x^2 + y^2 + z^2)^3
    end
    subsection v
      set Function expression = x*y*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
    subsection w
      set Function expression = x*z*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
  end
  subsection bc 4
    set id   = 4
    set type = function
    subsection u
      set Function expression = (x^2*(-0.75*(x^2 + y^2 + z^2)^(3/2) + 0.0625*sqrt(x^2 + y^2 + z^2) + (x^2 + y^2 + z^2)^2) - (y^2 + z^2)*(0.375*(x^2 + y^2 + z^2)^(3/2) + 0.03125*sqrt(x^2 + y^2 + z^2) - (x^2 + y^2 + z^2)^2))/(x^2 + y^2 + z^2)^3
    end
    subsection v
      set Function expression = x*y*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
    subsection w
      set Function expression = x*z*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
  end
  subsection bc 5
    set id   = 5
    set type = function weak
    set beta = 100
    subsection u
      set Function expression = (x^2*(-0.75*(x^2 + y^2 + z^2)^(3/2) + 0.0625*sqrt(x^2 + y^2 + z^2) + (x^2 + y^2 + z^2)^2) - (y^2 + z^2)*(0.375*(x^2 + y^2 + z^2)^(3/2) + 0.03125*sqrt(x^2 + y^2 + z^2) - (x^2 + y^2 + z^2)^2))/(x^2 + y^2 + z^2)^3
    end
    subsection v
      set Function expression = x*y*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
    subsection w
      set Function expression = x*z*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2)
    end
  end
end

# --------------------------------------------------
# IB particules
#---------------------------------------------------

subsection particles
  set number of particles                     = 1
  set assemble Navier-Stokes inside particles = false
  set levels not precalculated                = 0

  subsection extrapolation function
    set stencil order = 2
  end

  subsection local mesh refinement
    set initial refinement                = 0
    set refine mesh inside radius factor  = 0
    set refine mesh outside radius factor = 2
  end

  subsection particle info 0
    subsection position
      set Function expression = 0;0;0
    end
    subsection velocity
      set Function expression = 0;0;0
    end
    subsection omega
      set Function expression = 0;0;0
    end
    subsection orientation
      set Function expression = 1;1;1
    end
    set type            = opencascade
    set shape arguments = sphere_cad.step
  end
end

# --------------------------------------------------
# Analytical Solution
#---------------------------------------------------

subsection analytical solution
  set enable    = true
  set verbosity = verbose
  subsection uvwp
    set Function constants  = ri=0.5
    set Function expression = if(sqrt(x*x+y*y+z*z)>ri,(x^2*(-0.75*(x^2 + y^2 + z^2)^(3/2) + 0.0625*sqrt(x^2 + y^2 + z^2) + (x^2 + y^2 + z^2)^2) - (y^2 + z^2)*(0.375*(x^2 + y^2 + z^2)^(3/2) + 0.03125*sqrt(x^2 + y^2 + z^2) - (x^2 + y^2 + z^2)^2))/(x^2 + y^2 + z^2)^3, 0); if(sqrt(x*x+y*y+z*z)>ri,x*y*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2), 0); if(sqrt(x*x+y*y+z*z)>ri,x*z*(-0.375*x^2 - 0.375*y^2 - 0.375*z^2 + 0.09375)/(x^2 + y^2 + z^2)^(5/2), 0);if(sqrt(x*x+y*y+z*z)>ri,-0.75*x/(x^2 + y^2 + z^2)^(3/2), 0)
  end
end

# --------------------------------------------------
# Source term
#---------------------------------------------------

subsection source term
  set enable = true
  subsection xyz
